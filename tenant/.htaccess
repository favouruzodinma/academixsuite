RewriteEngine On
RewriteBase /tenant/

# 1. Allow direct access to existing files (css, js, images, etc.)
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^ - [L]

# 2. Allow direct access to existing directories
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# 3. Route ALL tenant URLs through router.php
# Pattern: /tenant/{school-slug}/{user-type}/{page}.php
RewriteRule ^([a-zA-Z0-9_-]+)/(admin|teacher|student|parent)/([a-zA-Z0-9_\-/]+\.php)$ router.php?school_slug=$1&user_type=$2&page=$3 [L,QSA]

# 4. Pattern: /tenant/{school-slug}/{user-type}/{page} (without .php)
RewriteRule ^([a-zA-Z0-9_-]+)/(admin|teacher|student|parent)/([a-zA-Z0-9_\-/]+)$ router.php?school_slug=$1&user_type=$2&page=$3.php [L,QSA]

# 5. Route school homepage to login
RewriteRule ^([a-zA-Z0-9_-]+)/?$ router.php?school_slug=$1&page=login.php [L,QSA]

# 6. Route school-specific login/logout
RewriteRule ^([a-zA-Z0-9_-]+)/(login|logout)/?$ router.php?school_slug=$1&page=$2.php [L,QSA]

# 7. Route subdirectory files
RewriteRule ^([a-zA-Z0-9_-]+)/(admin|teacher|student|parent)/([a-zA-Z0-9_\-/]+)/([a-zA-Z0-9_\-/]+\.php)$ router.php?school_slug=$1&user_type=$2&page=$3/$4 [L,QSA]

# DirectoryIndex
DirectoryIndex index.php router.php