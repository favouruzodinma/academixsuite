# /academixsuite/.htaccess - ENHANCED CONFIGURATION

# Enable rewrite engine
RewriteEngine On
RewriteBase /academixsuite/

# 1. ALLOW DIRECT ACCESS TO EXISTING FILES AND DIRECTORIES
# Allow extensionless files (index, default, etc.)
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# 2. ADD DEFAULT FILES FOR EXTENSIONLESS REQUESTS
# If request ends with /, try index files
RewriteCond %{REQUEST_URI} ^(.*)/$
RewriteCond %{DOCUMENT_ROOT}%1/index\.php -f
RewriteRule ^(.*)/$ $1/index.php [L]

RewriteCond %{REQUEST_URI} ^(.*)/$
RewriteCond %{DOCUMENT_ROOT}%1/index\.html -f
RewriteRule ^(.*)/$ $1/index.html [L]

RewriteCond %{REQUEST_URI} ^(.*)/$
RewriteCond %{DOCUMENT_ROOT}%1/index\.htm -f
RewriteRule ^(.*)/$ $1/index.htm [L]

# If request doesn't have extension, try adding .php, .html, .htm
RewriteCond %{REQUEST_URI} !\.[a-zA-Z0-9]{2,4}$
RewriteCond %{DOCUMENT_ROOT}%{REQUEST_URI}\.php -f
RewriteRule ^(.*)$ $1.php [L]

RewriteCond %{REQUEST_URI} !\.[a-zA-Z0-9]{2,4}$
RewriteCond %{DOCUMENT_ROOT}%{REQUEST_URI}\.html -f
RewriteRule ^(.*)$ $1.html [L]

RewriteCond %{REQUEST_URI} !\.[a-zA-Z0-9]{2,4}$
RewriteCond %{DOCUMENT_ROOT}%{REQUEST_URI}\.htm -f
RewriteRule ^(.*)$ $1.htm [L]

# 3. ROUTE /tenant/* REQUESTS TO TENANT DIRECTORY
# Keep your existing tenant routing
RewriteRule ^tenant/(.*)$ tenant/$1 [L]

# 4. ROUTE /platform/* REQUESTS TO PLATFORM
RewriteRule ^platform/(.*)$ platform/index.php?path=$1 [QSA,L]

# 5. ROUTE /login TO TENANT LOGIN
RewriteRule ^login/?$ tenant/login.php [L]

# 6. ALL OTHER REQUESTS GO TO PUBLIC
# Support extensionless files in public directory too
RewriteCond %{REQUEST_URI} !\.[a-zA-Z0-9]{2,4}$
RewriteCond %{DOCUMENT_ROOT}/academixsuite/public%{REQUEST_URI}\.php -f
RewriteRule ^(.*)$ public/$1.php [L]

RewriteCond %{REQUEST_URI} !\.[a-zA-Z0-9]{2,4}$
RewriteCond %{DOCUMENT_ROOT}/academixsuite/public%{REQUEST_URI}\.html -f
RewriteRule ^(.*)$ public/$1.html [L]

RewriteCond %{REQUEST_URI} !\.[a-zA-Z0-9]{2,4}$
RewriteCond %{DOCUMENT_ROOT}/academixsuite/public%{REQUEST_URI}\.htm -f
RewriteRule ^(.*)$ public/$1.htm [L]

# Default public routing (original rule)
RewriteRule ^(.*)$ public/$1 [L]

# Security headers
<IfModule mod_headers.c>
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "SAMEORIGIN"
    Header set X-XSS-Protection "1; mode=block"
    # Set proper MIME types for extensionless files
    <FilesMatch "^[^\.]+$">
        ForceType application/x-httpd-php
    </FilesMatch>
</IfModule>

# Set default index files
DirectoryIndex index.php index.html index.htm default.php default.html

# Disable directory listing
Options -Indexes +FollowSymLinks

# Protect sensitive files
<FilesMatch "^(\.htaccess|\.env|config\.php|composer\.(json|lock))$">
    Require all denied
</FilesMatch>

# Compression
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/xml application/json
</IfModule>

# Cache control
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
</IfModule>