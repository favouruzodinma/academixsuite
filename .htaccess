RewriteEngine On
RewriteBase /

# 1. ALLOW DIRECT ACCESS TO EXISTING FILES AND DIRECTORIES
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# 2. ROUTE /tenant/* REQUESTS TO TENANT DIRECTORY
RewriteRule ^tenant/(.*)$ /tenant/$1 [L,QSA]

# 3. ROUTE /platform/* REQUESTS TO PLATFORM
RewriteRule ^platform/(.*)$ /platform/index.php?path=$1 [L,QSA]

# 4. ROUTE /login TO TENANT LOGIN
RewriteRule ^login/?$ /tenant/login.php [L]

# 5. DEFAULT PUBLIC ROUTING
RewriteRule ^(.*)$ /public/$1 [L]

# Security headers
<IfModule mod_headers.c>
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "SAMEORIGIN"
    Header set X-XSS-Protection "1; mode=block"
</IfModule>

# Set default index files
DirectoryIndex index.php index.html index.htm

# Disable directory listing
Options -Indexes +FollowSymLinks

# Protect sensitive files
<FilesMatch "^(\.htaccess|\.env|config\.php|composer\.(json|lock))$">
    Require all denied
</FilesMatch>